<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional 8-week tennis conditioning program with workout tracking, exercise library, and personalized training plans">
    <meta name="theme-color" content="#2E7D32">

    <!-- Apple iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tennis Pro">

    <!-- Security headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <title>Tennis Conditioning Pro</title>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Header -->
        <header id="header">
            <button id="backBtn" class="icon-btn" style="display: none;" aria-label="Go back">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div class="header-title-group" id="headerTitleGroup">
                <span class="app-logo">üéæ</span>
                <h1 id="headerTitle">Tennis Conditioning Pro</h1>
            </div>
            <button id="themeBtn" class="icon-btn" title="Change Theme" aria-label="Change color theme">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>
        </header>

        <!-- Main Content Area -->
        <main id="mainContent">
            <!-- Breadcrumb Navigation -->
            <div id="breadcrumb" class="breadcrumb" style="display: none;">
                <a href="#" class="breadcrumb-item" id="breadcrumbPlan"></a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <a href="#" class="breadcrumb-item" id="breadcrumbWeek"></a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <span class="breadcrumb-item breadcrumb-current" id="breadcrumbDay"></span>
            </div>

            <!-- Plan Library View (Default) -->
            <div id="planLibraryView" class="view active">
                <div class="welcome-section">
                    <div class="tennis-ball-icon">üéæ</div>
                    <h2>Ready to Train?</h2>
                    <p>Choose a workout plan to get started</p>
                </div>

                <div class="plans-grid">
                    <div class="plan-card featured" data-plan="8-week">
                        <div class="plan-icon">üí™</div>
                        <div class="plan-card-content">
                            <h3>8-Week Program</h3>
                            <p>Complete conditioning journey</p>
                            <div class="plan-meta">
                                <span>8 weeks ‚Ä¢ 4 days/week</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card" data-plan="match-day">
                        <div class="plan-icon">üéæ</div>
                        <div class="plan-card-content">
                            <h3>Match Day Protocol</h3>
                            <p>Complete tournament day checklist</p>
                            <div class="plan-meta">
                                <span>6 Protocols ‚Ä¢ Pre-match to recovery</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card" data-plan="warmup">
                        <div class="plan-icon">üî•</div>
                        <div class="plan-card-content">
                            <h3>Warm-Up Protocol</h3>
                            <p>8-10 minute preparation routine</p>
                            <div class="plan-meta">
                                <span>10 min</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card" data-plan="cooldown">
                        <div class="plan-icon">‚ùÑÔ∏è</div>
                        <div class="plan-card-content">
                            <h3>Cool-Down Protocol</h3>
                            <p>5-7 minute recovery routine</p>
                            <div class="plan-meta">
                                <span>7 min</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card" data-plan="nutrition">
                        <div class="plan-icon">üçé</div>
                        <div class="plan-card-content">
                            <h3>Nutrition Guide</h3>
                            <p>Complete meal plans & nutrition guidelines</p>
                            <div class="plan-meta">
                                <span>10 Categories ‚Ä¢ 50+ Meals</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card" data-plan="exercises">
                        <div class="plan-icon">üìö</div>
                        <div class="plan-card-content">
                            <h3>Exercise Library</h3>
                            <p>Browse all 150+ exercises</p>
                            <div class="plan-meta">
                                <span>Reference</span>
                            </div>
                        </div>
                    </div>

                    <div class="plan-card custom" data-plan="custom">
                        <div class="plan-icon">‚ú®</div>
                        <div class="plan-card-content">
                            <h3>Custom Workout</h3>
                            <p>Create your own plan</p>
                            <div class="plan-meta">
                                <span>Build</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Week Selector View -->
            <div id="weekSelectorView" class="view">
                <div class="section-header">
                    <h2>8-Week Program</h2>
                    <p>Select a week to continue</p>
                </div>
                <div id="weekGrid" class="week-grid"></div>
            </div>

            <!-- Match Day Protocol Selector View -->
            <div id="matchDayProtocolView" class="view">
                <div class="section-header">
                    <h2>Match Day Protocol</h2>
                    <p>Select a protocol to view</p>
                </div>
                <div id="protocolGrid" class="week-grid"></div>
            </div>

            <!-- Nutrition Plan Category Selector View -->
            <div id="nutritionPlanView" class="view">
                <div class="section-header">
                    <h2>Nutrition Guide</h2>
                    <p>Select a category to explore</p>
                </div>
                <div id="nutritionGrid" class="week-grid"></div>
            </div>

            <!-- Day Selector View -->
            <div id="daySelectorView" class="view">
                <div class="section-header">
                    <h2 id="weekTitle">Week 1</h2>
                    <p>Choose your training day</p>
                </div>
                <div id="dayGrid" class="day-grid"></div>
            </div>

            <!-- Workout Session View -->
            <div id="workoutView" class="view">
                <div class="workout-header">
                    <div class="workout-header-left">
                        <h2 id="workoutTitle">Monday - Speed & Agility</h2>
                        <div class="workout-meta">
                            <span id="workoutDuration">35 min</span>
                            <span id="workoutProgress">0/12 exercises</span>
                        </div>
                    </div>
                    <div class="workout-header-right">
                        <div class="global-duration-toggle" id="globalDurationToggle" style="display: none;">
                            <span class="duration-label">Min</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="globalDurationPreference" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="duration-label">Max</span>
                        </div>
                        <div class="workout-timer">
                            <div class="timer-display">
                                <span class="timer-icon">‚è±Ô∏è</span>
                                <span id="workoutTimer">0:00</span>
                            </div>
                            <div class="timer-controls">
                                <button id="playPauseBtn" class="timer-btn" title="Play">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                                <button id="resetTimerBtn" class="timer-btn" title="Reset">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                        <path d="M3 3v5h5"/>
                                    </svg>
                                </button>
                                <button id="voiceGuidedBtn" class="timer-btn voice-guided-btn" title="Start Voice-Guided Workout" style="display: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                        <line x1="12" y1="19" x2="12" y2="23"/>
                                        <line x1="8" y1="23" x2="16" y2="23"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="exerciseList" class="exercise-list">
                    <!-- Exercise cards will be dynamically inserted here -->
                </div>
            </div>

            <!-- Exercise Library View -->
            <div id="exerciseLibraryView" class="view">
                <div class="section-header">
                    <h2>Exercise Library</h2>
                    <input type="search" id="exerciseSearch" placeholder="Search exercises..." class="search-input">
                </div>

                <div class="filter-chips">
                    <button class="chip active" data-category="all">All</button>
                    <button class="chip" data-category="warmup">Warm-up</button>
                    <button class="chip" data-category="core">Core</button>
                    <button class="chip" data-category="lower">Lower Body</button>
                    <button class="chip" data-category="upper">Upper Body</button>
                    <button class="chip" data-category="plyo">Plyometrics</button>
                    <button class="chip" data-category="agility">Agility</button>
                </div>

                <div id="exerciseGrid" class="exercise-grid">
                    <!-- Exercise reference cards will be inserted here -->
                </div>
            </div>

            <!-- Custom Workout Builder View -->
            <div id="customWorkoutView" class="view">
                <div class="section-header">
                    <h2>Custom Workout</h2>
                    <p>Build your personalized training session</p>
                </div>
                <div class="custom-builder">
                    <button id="addExerciseBtn" class="primary-btn">+ Add Exercise</button>
                    <div id="customExerciseList" class="exercise-list">
                        <div class="empty-state">
                            <p>No exercises added yet</p>
                            <p class="hint">Tap "Add Exercise" to get started</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation (Optional for future use) -->
        <nav id="bottomNav" style="display: none;">
            <button class="nav-btn active" data-view="home">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span>Home</span>
            </button>
        </nav>
    </div>

    <!-- Modal for Exercise Details -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Voice-Guided Workout Configuration Modal -->
    <div id="voiceConfigModal" class="modal">
        <div class="modal-content voice-config-modal">
            <button class="modal-close" id="voiceConfigClose">&times;</button>
            <div class="modal-header">
                <h2>Voice-Guided Workout</h2>
                <p>Configure your hands-free workout experience</p>
            </div>
            <div class="modal-body">
                <div class="config-section">
                    <label class="config-label">
                        <span class="config-title">Pause Between Exercises</span>
                        <span class="config-description">Rest time before next exercise</span>
                    </label>
                    <div class="config-options">
                        <button class="config-btn" data-pause="5">5s</button>
                        <button class="config-btn active" data-pause="10">10s</button>
                        <button class="config-btn" data-pause="15">15s</button>
                        <button class="config-btn" data-pause="30">30s</button>
                    </div>
                </div>

                <div class="config-section">
                    <label class="config-label">
                        <span class="config-title">Voice Guidance</span>
                        <span class="config-description">Spoken exercise instructions</span>
                    </label>
                    <div class="config-toggle">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <label for="voiceEnabled" class="toggle-label">
                            <span class="toggle-switch"></span>
                            <span class="toggle-text">Enabled</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <label class="config-label">
                        <span class="config-title">Audio Countdown</span>
                        <span class="config-description">Beeps for last 5 seconds</span>
                    </label>
                    <div class="config-toggle">
                        <input type="checkbox" id="beepsEnabled" checked>
                        <label for="beepsEnabled" class="toggle-label">
                            <span class="toggle-switch"></span>
                            <span class="toggle-text">Enabled</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <label class="config-label">
                        <span class="config-title">Keep Screen Awake</span>
                        <span class="config-description">Prevent screen from sleeping (may not work on all devices)</span>
                    </label>
                    <div class="config-toggle">
                        <input type="checkbox" id="wakeLockEnabled">
                        <label for="wakeLockEnabled" class="toggle-label">
                            <span class="toggle-switch"></span>
                            <span class="toggle-text">Disabled</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="startVoiceWorkout" class="primary-btn large-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    Start Workout
                </button>
            </div>
        </div>
    </div>

    <!-- Voice-Guided Workout Modal -->
    <div id="voiceWorkoutModal" class="modal">
        <div class="modal-content voice-workout-modal">
            <div class="voice-workout-header">
                <div class="workout-status">
                    <span class="status-indicator">üéôÔ∏è</span>
                    <span class="status-text">Voice Mode Active</span>
                </div>
                <button class="icon-btn" id="voiceWorkoutClose" title="Stop Workout">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="voice-workout-body">
                <!-- Progress Info -->
                <div class="voice-progress-info">
                    <h2 id="voiceWorkoutTitle">Warm-Up Protocol</h2>
                    <div class="progress-stats">
                        <span id="voiceExerciseProgress">Exercise 1 of 10</span>
                        <span class="separator">‚Ä¢</span>
                        <span id="voiceTotalTime">0:00 elapsed</span>
                    </div>
                </div>

                <!-- Section Timeline Progress -->
                <div class="voice-section-timeline" id="voiceSectionTimeline">
                    <!-- Timeline will be generated dynamically -->
                </div>

                <!-- Current Section (kept for reference, can be hidden) -->
                <div class="voice-section-display" style="display: none;">
                    <div class="section-label">Current Section</div>
                    <div id="voiceCurrentSection" class="section-name">Dynamic Stretching</div>
                </div>

                <!-- Current Exercise -->
                <div class="voice-exercise-display">
                    <div id="voiceCurrentExercise" class="exercise-name">Arm Circles</div>
                    <div id="voiceExerciseDetails" class="exercise-details">
                        2 sets ‚Ä¢ 30 seconds each
                    </div>
                </div>

                <!-- Duration Range Toggle (shown only for range durations) -->
                <div id="durationRangeToggle" class="duration-range-toggle" style="display: none;">
                    <label id="durationMinLabel">20s</label>
                    <div class="duration-toggle-switch" id="durationToggleSwitch">
                        <div class="duration-toggle-knob"></div>
                    </div>
                    <label id="durationMaxLabel">30s</label>
                </div>

                <!-- Timer Display (Clickable) -->
                <div class="voice-timer-display" id="voiceTimerClickable" title="Click to Play/Pause">
                    <div class="timer-circle">
                        <svg class="timer-ring" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#4caf50;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle class="timer-ring-bg" cx="100" cy="100" r="90"/>
                            <circle class="timer-ring-progress" cx="100" cy="100" r="90" id="voiceTimerRing"/>
                        </svg>
                        <div class="timer-text">
                            <div id="voiceTimerDisplay" class="timer-value">00:00</div>
                            <div id="voiceTimerLabel" class="timer-label">Ready</div>
                        </div>
                        <!-- Play/Pause Icon Overlay -->
                        <div class="timer-play-overlay">
                            <svg class="play-icon" width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            <svg class="pause-icon hidden" width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Compact Navigation Controls -->
                <div class="voice-compact-controls">
                    <button id="voicePrevSectionBtn" class="voice-compact-btn" title="Previous Section">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M11 19l-7-7 7-7M18 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button id="voicePrevExerciseBtn" class="voice-compact-btn" title="Previous Exercise">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button id="voicePlayPauseBtn" class="voice-compact-btn primary-compact" title="Play/Pause">
                        <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg class="pause-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                        </svg>
                    </button>
                    <button id="voiceNextExerciseBtn" class="voice-compact-btn" title="Next Exercise">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    <button id="voiceNextSectionBtn" class="voice-compact-btn" title="Next Section">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M13 5l7 7-7 7M6 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>

    <!-- Confetti Container -->
    <div id="confettiContainer" class="confetti-container"></div>

    <!-- Debug Console (for mobile debugging) - Add ?debug=true to URL to enable -->
    <script>
      (function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('debug') === 'true') {
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/eruda';
          script.onload = function() {
            eruda.init();
            console.log('Debug console enabled - Check the icon in bottom right corner');
          };
          document.head.appendChild(script);
        }
      })();
    </script>

    <!-- Scripts -->
    <script src="./js/auth.js"></script>
    <script src="./js/features.js"></script>
    <script src="./js/data-encrypted.js"></script>
    <script src="./js/storage.js"></script>
    <script src="./js/timer.js"></script>
    <script src="./js/voice-workout.js"></script>
    <script src="./js/voice-workout-controller.js"></script>
    <script src="./js/app.js"></script>

    <!-- App Initialization -->
    <script>
      // Create instances
      window.Auth = new window.AuthClass();
      window.AppFeatures = new window.AppFeaturesClass();

      // Initialize app
      (async function initApp() {
        // Check for corrupted storage
        if (!window.AppFeatures.checkLocalStorage()) {
          window.AppFeatures.handleCorruptedStorage();
          return;
        }

        // Check if password protection is enabled
        if (window.ENCRYPTED_DATA) {
          // Check for valid session AND if data is available in memory
          // On page reload, session may be valid but data/password is lost from memory
          if (!window.Auth.isSessionValid() || !window.DATA) {
            await window.Auth.showPasswordPrompt();
          } else {
            // Re-authenticate with stored session
            window.Auth.isAuthenticated = true;
          }
        }

        // Validate data
        try {
          if (window.DATA) {
            window.AppFeatures.validateExerciseData(window.DATA);
          }
        } catch (error) {
          console.error('Data validation failed:', error);
          window.AppFeatures.showError('Application data is corrupted. Please contact support.', true);
          return;
        }

        // Initialize the main app
        if (window.TennisApp) {
          window.TennisApp.init();
        }

        // Initialize Voice Workout Controller
        if (window.VoiceWorkoutController) {
          window.VoiceWorkout = new window.VoiceWorkoutController();
          window.VoiceWorkout.init();
        }
      })();
    </script>
</body>
</html>
